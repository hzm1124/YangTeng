# 断货汇报
## 0. 公式
- |列|公式|
  |:-:|:-|
  |`在库为0（断货数）`| = `在库`[0]|
  |`在库1-2（干预数）`| = `在库`[1] + `在库`[2]|
  |`近期海运上架后断货数`| = `在库+海运上架数`[0]|
  |`断货无在途`| = `在库`&`在途`[0]|
  |`干预无在途`| = `在库`[1]&`在途`[0] + `在库`[2]&`在途`[0]|
  |`断货SKU数量`| = `在库`[0]|

## 0. 旧公式
- |列|公式|
  |:-:|:-|
  |`在库为0（断货数）`| = `在库`[0] - `清仓`&`在库`[0] - `新品`&`在库`[0] - `新品成长`&`在库`[0]|
  |`在库1-2（干预数）`| = `老品`&`在库`[1] + `断货`&`在库`[1] + `断货成长`&`在库`[1] +<br />`老品`&`在库`[2] + `断货`&`在库`[2] + `断货成长`&`在库`[2]|
  |`近期海运上架后断货数`| = `老品`&`在库+海运上架数`[0] + `断货`&`在库+海运上架数`[0] + `断货成长`&`在库+海运上架数`[0]|
  |`断货无在途`| = `在库`&`在途`[0] - `清仓`&`在库`&`在途`[0] - `新品`&`在库`&`在途`[0] - `新品成长`&`在库`&`在途`[0]|
  |`干预无在途`| = `老品`&`在库`[1]&`在途`[0] + `断货`&`在库`[1]&`在途`[0] + `断货成长`&`在库`[1]&`在途`[0] +<br />`老品`&`在库`[2]&`在途`[0] + `断货`&`在库`[2]&`在途`[0] + `断货成长`&`在库`[2]&`在途`[0]|
  |`断货SKU数量`| = `在库`[0] - `新品`&`在库`[0] - `清仓`&`在库`[0] - `清仓`&`在库`[0]|

## 1. 流程
### 1.1. Python部分
1. 运行代码`1.替代料表整理`，获取`整理好的替代料总表`（如果Liz整理好的数据能直接用就可以忽略这步，但是要保证文件名一致）
2. 运行代码`2.统计源生成`，获取`统计源`

### 1.2. Excel部分
1. 修改`计算表`文件名中的日期
2. 更新`附_1统计源（含新品、清仓、新品成长）`（数据以mrp为主，输出结果剔除了`清仓`和`新品无在库`的SKU）
    - 更改顶部的日期
    - 把`统计源`复制进来
    - 修改右上角4个公式所用的单元格区间
3. 更新`2_断货SKU`
    - 更改顶部的日期
    - 从`附_1统计源（含新品、清仓、新品成长）`筛选`在库`列是`0`、`在途`列也是`0`、`Level`列不是`普通`的SKU，结果按`层级`列升序排序，取消`附_1统计源（含新品、清仓、新品成长）`的筛选（这步可以运行代码`3.断货SKU筛选`直接获取结果）
    - 下拉`品类`列的公式
    - 根据`品类`列更新`品类去重`列和`断货数`列
    - 按`断货数`列降序排序
4. 更新`1_断货数据分析`
    - `表3`的第一列删掉，其余内容整体前移一列，空出来的最后一列填充`D`列数据
    - 检查`表4`的`品类`列是否需要更新（与`附_1统计源（含新品、清仓、新品成长）`（`MRP表`）保持一致）
    - `表4`按`断货SKU数量`列降序、`总SKU数`列升序排序

## 1. 旧流程
1. 修改`计算表`文件名中的日期
2. 把`新老品在途管控表`（`海运表`）的`US. 在途明细-总表`复制到`计算表`的`海运表到xx-xx`，并修改`海运表到xx-xx`对应的日期
3. 运行`替代料表整理`，获取`整理好的替代料总表`
4. 运行`库存表生成`，获取`整理好的库存表`，并复制到`计算表`的`附2_库存表`
5. 更新`计算表`的`附_1统计源（含新品、清仓、新品成长）`
    - 更改顶部的日期
    - `在库`列使用`整理好的库存表`的`库存`，`近期海运上架`列和`在库+海运上架数`列是公式，其余内容从`MRP表`复制
    - 修改右上角4个公式所用的单元格区间
6. 运行`断货SKU筛选`，获取`筛选好的断货SKU`
7. 更新`计算表`的`2_断货SKU`
    - 更改顶部的日期
    - 把`筛选好的断货SKU`的内容复制进来
    - 拉取`品类`列的公式
    - 更新`品类去重`列
    - 按`断货数`列降序、`品类去重`列升序排序
8. 更新`计算表`的`1_断货数据分析`
    - `表3`的第一列删掉，其余内容整体向前提一列，最后一列填充`1_断货数据分析`的`D`列数据
    - 检查`表4`的`品类`列是否需要更新（与`附_1统计源（含新品、清仓、新品成长）`（`MRP表`）保持一致）
    - `表4`按`断货SKU数量`列降序、`总SKU数`列和`品类`列升序排序
9. 运行`邮件数据核对`，根据结果核对邮件内容